
前端模板化与X通用平台技术 探讨

##概述##

**业务场景：**

为了完成Web平台（主业务平台）上的某些业务功能，需要有以下三大模块：

- 前端模板.js：N段JS及HTML代码集合，它们是功能的界面UI。
- 主业务平台：前端模板.js 的后端。
- X通用平台：实现了业务功能的平台。

**目标：**

- 前端模板.js：尽可能的通用化，可复用于多个“主业务平台”。
- 主业务平台：尽可能的与业务功能无关。
- X通用平台：专注于完成业务功能。

以下几种方案均抛弃了跨域请求的方案，因为此种方案对浏览器有要求，并且会使前端模板代码复杂化。

## 方案 ##

###主方案一：业务接口平行化 ###

![](http://ww3.sinaimg.cn/bmiddle/60c9620fgw1eichclc0wmj20gu09qq3a.jpg)

描述：X通用平台提供api jar包给 主业务平台，主业务平台接受 前端模板的API请求后，调用api jar包请求X通用平台。所谓接口平行化，就是指 主业务平台 与X通用平台的接口数量 和 主业务平台与前端模板 的接口数量 是一样的。

###主方案二 业务接口隔离化：X通用平台反调 ###

![](http://ww3.sinaimg.cn/bmiddle/60c9620fgw1eichclcs0kj20gp09jjru.jpg)

描述：这是一种成熟的技术方案。前端模板通过Nginx转发来同域的调用X通用平台，X通用平台区获取请求后，调用 主业务平台 获取此请求相关的权限。

###主方案三 业务接口隔离化：token方案 ###

![](http://ww2.sinaimg.cn/bmiddle/60c9620fgw1eichclj4ipj20gp09jt96.jpg)

描述：前端模板还是通过Nginx转发来同域调用X通用平台，但是，在每次调用之前都先调用主业务平台获取一个加密的TOken，X通用平台在接受到请求时，解密Token，验证此请求是否有权限。

###主方案四 业务接口隔离化：Proxy 方案 ###

![](http://ww4.sinaimg.cn/bmiddle/60c9620fgw1eichclp65mj20mr04tmxi.jpg)

描述：前端模板通过主业务平台的转发功来发送请求给X通用平台。主业务平台在转发的同时，又做了权限的功能。

## 方案比较 ##

<table border="0" cellspacing="0" cellpadding="0">
  	<tr>
	    <th></th>
	    <th>业务接口平行化</th>
		<th>业务接口隔离化：X通用平台反调</th>
		<th>业务接口隔离化：token方案</th>
		<th>业务接口隔离化：Proxy 方案</th>
	</tr>
	<tr>
		<td width="150px"><b>多个主业务平台的情况下</b></td>
		<td width="150px">接口数量急剧增加，每个业务平台的代码复制粘贴严重</td>
		<td width="150px">所有业务平台均需要额外提供RPC接口。每添加一个业务平台，X通用平台均需要升级更改配置。</td>
		<td width="150px">所有业务平台需要提供一个Token的接口。</td>
		<td width="150px">所有业务平台需要实现一个转发的功能</td>
	</tr>
	<tr>
		<td width="150px"><b>优点</b></td>
		<td width="150px">简单粗暴</td>
		<td width="150px">技术成熟，有大量的实例验证。X通用平台选择灵活，可以自行控制权限，或者通过反调来控制权限。</td>
		<td width="150px">通过提供Token，解决需要反调的问题。</td>
		<td width="150px">业务平台提供了业务相关的过滤方案，X通用平台和业务平台间解耦。</td>
	</tr>
	<tr>
		<td width="150px"><b>缺点</b></td>
		<td width="150px">开发量大，冗余代码量大</td>
		<td width="150px">每增加一个业务平台，X通用平台均需要感知，耦合性增加。另外，多种控制权限的方法也会导致同个接口增加多种逻辑判断。</td>
		<td width="150px">前端模板需要两次调用，挑战较大</td>
		<td width="150px">技术较新，有挑战。由于业务平台做了些过滤功能，可能会限制了X通用平台未来扩展的灵活性。</td>
	</tr>
	<tr>
		<td width="150px"><b>建议</b></td>
		<td width="150px">不采用</td>
		<td width="150px">推荐</td>
		<td width="150px">暂时不推荐（由于前端改变较大）</td>
		<td width="150px">推荐</td>
	</tr>
</table>

