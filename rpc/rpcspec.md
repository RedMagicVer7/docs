本规范所述接口，指的是平台提供的远程过程调用（RPC）接口，用于平台之间以及客户端和平台之间的相互访问。

历史上公司各内部平台根据自身的需要，使用了不同的技术，形成了自己的接口规范。由于多种接口技术之间并不能兼容，导致在调用不同平台时需要熟悉不同的技术，障碍较多。本规范希望通过约束接口技术的使用，并推动平台改造，最终实现无障碍的相互访问。

接口主要涉及通讯协议和数据交换格式两大块。

目前主流的RPC通讯协议可以分为HTTP和二进制两大类。HTTP是互联网广泛使用的通讯协议，跨平台能力强，被各种语言支持，同时也有利于向外开放。二进制相对HTTP可以做到更高的通讯效率，适合在公司内部使用。考虑到两者都有存在的必要性，本规范允许使用HTTP和二进制两种接口。平台可以只提供其中一种，也可以两种都提供。在同时提供两种接口时，应注意保持接口语义上的完全一致性。

数据交换格式主要指通讯双方以何种方式对需要交换的数据进行打包传输。一个良好的数据交换格式最重要的特性是向前向后兼容性。即老版本的数据可以被新版本的接口识别，同时新版本的数据也可以被老版本的接口识别（即便会丢失一些新的功能），这将使得平台升级变得更为容易。

下面分别对两种形式的通讯协议进行阐述。

## HTTP接口 ##

服务应以标准的HTTP协议对外发布接口。

数据交换格式默认应使用JSON。JSON格式须遵循百度JSON规范（待定）。Content-Type使用application/json。有特殊需求的接口不受此限制。例如上传文件可以使用multipart/form-data；下载文件可以根据实际内容选用合适的Content-Type。

URL和JSON中的字符编码一律使用UTF-8。

建议使用RESTful形式的Web Service接口。由于RESTful并非一个严格的规范，本规范对此不做强制规定。

## 二进制接口 ##

###简介###

公司内部平台的二进制接口所使用的数据交换格式多种多样，通讯协议更是五花八门。造成这种现状一方面是因为一些历史原因，另一方面在不同的应用场景下，的确存在使用某些数据交换格式效率更高的现象。

很难找到一种能够满足所有需求的二进制数据交换格式，本规范选择Protobuf作为基本的数据交换格式，出于以下考虑：

- 公司日志规范使用Protobuf。
- Protobuf的效率相对较高。
- Protobuf能够满足向前向后兼容性要求。
- 对于公司的四种主流语言C/C++、Java、Pyhon、PHP，Protobuf官方支持前三种，第四种由公司日志团队dt-logging支持，已在线上主要产品线使用。

###二进制接口规范###

Protocol Buffer官方仅给出了接口形式，没有给出具体的通讯协议。本规范使用Protobuf RPC通讯协议。平台应遵循该协议进行通讯。

数据交换格式必须使用Protocol Buffer。

Protocol Buffer中string类型的编码一律使用UTF-8。